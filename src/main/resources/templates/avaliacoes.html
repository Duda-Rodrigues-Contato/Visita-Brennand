<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão Viva - Dashboard de Avaliações</title>
    <link rel="icon" th:href="@{/img/1.png}" type="image/x-icon" />
    <link rel="stylesheet" th:href="@{/css/dashboard-relatorio.css}">
    <style>
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .stat-card { background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); text-align: center; border-top: 4px solid var(--verde-principal); }
        .stat-value { font-size: 2.5rem; font-weight: bold; color: var(--texto-escuro); margin: 10px 0; }
        .stat-label { color: var(--texto-secundario); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; }
        .avaliacao-item { background: white; padding: 1.5rem; margin-bottom: 1rem; border-left: 5px solid var(--laranja-principal); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .av-header { display: flex; justify-content: space-between; color: var(--texto-secundario); font-size: 0.85rem; margin-bottom: 0.5rem; }
        .av-stars { color: var(--laranja-principal); font-size: 1.2rem; }
        .av-comment { font-style: italic; margin-top: 10px; color: var(--texto-escuro); }
    </style>
</head>
<body>
    
    <header class="header">
        <div class="header__container">
            <a href="/status-parque" class="brand">
                <img th:src="@{/img/1.png}" alt="Logo Gestão Viva" class="brand__logo" />
                <span>Gestão Viva</span>
            </a>
            <nav class="nav">
                <a href="/status-parque" class="nav-link">Início</a>
                <a href="/agendamento" class="nav-link">Agendamento</a>
                <a href="/dashboard" class="nav-link">Relatório</a>
                <a href="/dashboard/avaliacoes" class="nav-link active" style="font-weight: bold;">Avaliações</a>
            </nav>
        </div>
    </header>
    
    <div class="main-container">
        <main>
            <section class="card filter-card">
                <h2>Dashboard de Satisfação</h2>
                <form th:action="@{/dashboard/avaliacoes}" method="get" class="filter-form">
                    <div class="date-inputs">
                        <div class="form-group">
                            <label for="dataInicio">Data Início</label>
                            <input type="date" id="dataInicio" name="dataInicio" th:value="${#temporals.format(dataInicio, 'yyyy-MM-dd')}">
                        </div>
                        <div class="form-group">
                            <label for="dataFim">Data Fim</label>
                            <input type="date" id="dataFim" name="dataFim" th:value="${#temporals.format(dataFim, 'yyyy-MM-dd')}">
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Filtrar</button>
                        <a th:href="@{/dashboard/avaliacoes}" class="btn btn-secondary">Limpar</a>
                    </div>
                </form>
            </section>

            <section class="stats-grid" th:if="${stats.totalAvaliacoes > 0}">
                <div class="stat-card">
                    <div class="stat-value" th:text="${#numbers.formatDecimal(stats.mediaAvaliacaoGeral, 1, 1)}">0.0</div>
                    <div class="stat-label">Satisfação Geral</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" th:text="${#numbers.formatDecimal(stats.mediaRecomendacao, 1, 1)}">0.0</div>
                    <div class="stat-label">NPS (Recomendação)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" th:text="${#numbers.formatDecimal(stats.mediaLimpezaOrganizacao, 1, 1)}">0.0</div>
                    <div class="stat-label">Limpeza</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" th:text="${#numbers.formatDecimal(stats.mediaQualidadeRecepcao, 1, 1)}">0.0</div>
                    <div class="stat-label">Atendimento</div>
                </div>
            </section>

            <div th:if="${stats.totalAvaliacoes == 0}" class="empty-message">
                Nenhuma avaliação encontrada para o período selecionado.
            </div>

            <section>
                <h3 style="margin-top: 2rem; color: var(--texto-secundario);">Últimas Avaliações Recebidas</h3>
                <div th:each="avaliacao : ${paginaDeAvaliacoes.content}" class="avaliacao-item">
                    <div class="av-header">
                        <span th:text="${#temporals.format(avaliacao.dataAvaliacao, 'dd/MM/yyyy HH:mm')}">Data</span>
                        <span th:text="${avaliacao.visita?.nomeInstituicao}">Visitante</span>
                    </div>
                    <div>
                        <span class="av-stars">
                            <span th:text="${avaliacao.avaliacaoGeral}">5</span> <small>/ 5</small> ★
                        </span>
                    </div>
                    <div th:if="${avaliacao.comentariosSugestoes != null}" class="av-comment">
                        "<span th:text="${avaliacao.comentariosSugestoes}">...</span>"
                    </div>
                </div>
            </section>
        </main>
    </div>
</body>
</html>